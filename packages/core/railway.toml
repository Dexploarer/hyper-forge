# Railway Configuration for Asset-Forge
# This configuration file defines build and deployment settings for Railway environments
# Supports staging and production environments with environment-specific configurations
# Uses Railpack (Nixpacks is deprecated as of 2025)

[build]
# Build command - install dependencies and build frontend
buildCommand = "bun install && bun run build"

# Watch paths for automatic rebuilds
watchPatterns = [
  "src/**",
  "server/**",
  "package.json",
  "bun.lock"
]

[deploy]
# Start command - run database migrations and start production server
startCommand = "bun run start:api"

# Restart policy - restart on failure up to 10 times
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Health check configuration
healthcheckPath = "/api/health/live"
healthcheckTimeout = 10

# Production environment configuration
[environments.production]
# Link to main branch
branch = "main"

# Production-specific settings
[environments.production.variables]
NODE_ENV = "production"
LOG_LEVEL = "info"

# Staging environment configuration
[environments.staging]
# Link to staging branch
branch = "staging"

# Staging-specific settings
[environments.staging.variables]
NODE_ENV = "staging"
LOG_LEVEL = "debug"

# Development environment configuration (optional)
[environments.development]
# Link to dev branch (if you want a dev environment on Railway)
branch = "dev"

[environments.development.variables]
NODE_ENV = "development"
LOG_LEVEL = "debug"
