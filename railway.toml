# Railway Deployment Configuration - Main API Service
# Using Railpack (Railway's modern builder, replaces deprecated Nixpacks)
# Deployed: March 2025
#
# PORT CONFIGURATION (November 2025):
# Main API REQUIRES PORT environment variable - Railway auto-assigns it
# Server binds to 0.0.0.0:$PORT (see api-elysia.ts:97)
# Never hardcode the port - always use process.env.PORT

[build]
builder = "RAILPACK"
buildCommand = "cd apps/core && bun run clean && bunx vite build"

[deploy]
startCommand = "cd apps/core && bun run start:api"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Watch paths for automatic rebuilds
[[deploy.watchPaths]]
paths = ["apps/core/**"]

# Environment configuration
[env]
# Node environment (set to production in Railway dashboard)
# NODE_ENV = "production"

# Railway automatically provides (DO NOT SET MANUALLY):
# - PORT (dynamically assigned, used by api-elysia.ts:97)
# - DATABASE_URL (from PostgreSQL plugin)
# - RAILWAY_ENVIRONMENT (production/staging/development)
# - RAILWAY_STATIC_URL (generated Railway URL)
# - RAILWAY_PUBLIC_DOMAIN (if custom domain configured)

# Required environment variables (set in Railway Dashboard):
# - PRIVY_APP_ID
# - PRIVY_APP_SECRET
# - AI_GATEWAY_API_KEY (or OPENAI_API_KEY)
# - MESHY_API_KEY
# - ELEVENLABS_API_KEY
# - ADMIN_UPLOAD_TOKEN (for asset uploads)
